###############################################
# KOBOLD GOVERN. EVENTS - "Kobolds Expanded"  #
#                                             #
# By L. E. H.                                 #
###############################################

namespace = kob_expanded_government_events

###############################################
# Buruzagi Elections                          #
###############################################

#Event to elect a leader
country_event = {
	id = kob_expanded_government_events.1001
	title = kob_expanded_government_events.1001.title
	desc = kob_expanded_government_events.1001.desc

	picture = kob_expanded_event_kobold_election

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			# Changes your new ruler culture to the actual culture they're supposed to have, and give them a small boost to stats
			kob_expanded_change_ruler_culture = yes
		}
	}

	option = { # Keep our ruler
		name = kob_expanded_government_events.1001.g
		custom_tooltip = kob_expanded_keepingRulerIncreasesDisorder.tooltip

		add_government_power = {
			mechanic_type = kob_expanded_interal_disorder
			power_type = kob_expanded_disorder
			value = 5
		}
		add_legitimacy = -15
		if = {
			limit = {
				has_estate = estate_nobles
			}
			add_estate_loyalty = {
				estate = estate_nobles
				loyalty = -10
			}
		}
	}

	option = {
		# Appoint Red Scale
		name = kob_expanded_government_events.1001.a

		trigger = {
			NOT = {
				has_country_modifier = kob_expanded_redscale_kobold_ruler
			}
		}

		define_ruler = {
			culture = redscale_kobold
			max_random_adm = 3
			max_random_dip = 4
			max_random_mil = 5
			min_age = 25
			max_age = 35
		}

		hidden_effect = {
			kob_expanded_remove_kobold_ruler_modifier = yes
			add_country_modifier = {
				name = kob_expanded_redscale_kobold_ruler
				duration = -1
				hidden = yes
			}
			set_ruler_culture = redscale_kobold
		}
	}

	option = {
		# Appoint Blue Scale
		name = kob_expanded_government_events.1001.b

		trigger = {
			NOT = {
				has_country_modifier = kob_expanded_bluescale_kobold_ruler
			}
		}
		
		define_ruler = {
			culture = bluescale_kobold
			max_random_adm = 4
			max_random_dip = 4
			max_random_mil = 2
			min_age = 25
			max_age = 35
		}
		hidden_effect = {
			kob_expanded_remove_kobold_ruler_modifier = yes
			add_country_modifier = {
				name = kob_expanded_bluescale_kobold_ruler
				duration = -1
				hidden = yes
			}
			set_ruler_culture = bluescale_kobold
		}
	}

	option = {
		# Appoint Green Scale
		name = kob_expanded_government_events.1001.c

		trigger = {
			NOT = {
				has_country_modifier = kob_expanded_greenscale_kobold_ruler
			}
		}

		define_ruler = {
			culture = greenscale_kobold
			max_random_adm = 4
			max_random_dip = 6
			max_random_mil = 2
			min_age = 25
			max_age = 35
		}
		hidden_effect = {
			kob_expanded_remove_kobold_ruler_modifier = yes
			add_country_modifier = {
				name = kob_expanded_greenscale_kobold_ruler
				duration = -1
				hidden = yes
			}
			set_ruler_culture = greenscale_kobold
		}
	}

	option = {
		# Appoint Gold Scale
		name = kob_expanded_government_events.1001.d

		trigger = {
			any_owned_province = {
				culture = goldscale_kobold
			}
			NOT = {
				has_country_modifier = kob_expanded_goldscale_kobold_ruler
			}
		}

		define_ruler = {
			culture = goldscale_kobold
			max_random_adm = 4
			max_random_dip = 5
			max_random_mil = 2
			min_age = 25
			max_age = 35
		}
		hidden_effect = {
			kob_expanded_remove_kobold_ruler_modifier = yes
			add_country_modifier = {
				name = kob_expanded_goldscale_kobold_ruler
				duration = -1
				hidden = yes
			}
			set_ruler_culture = goldscale_kobold
		}
	}

	option = {
		# Appoint Dark Scale
		name = kob_expanded_government_events.1001.e

		trigger = {
			any_owned_province = {
				culture = darkscale_kobold  
			}
			NOT = {
				has_country_modifier = kob_expanded_darkscale_kobold_ruler
			}
		}

		define_ruler = {
			culture = darkscale_kobold
			max_random_adm = 2
			max_random_dip = 5
			max_random_mil = 3
			min_age = 25
			max_age = 35
		}
		hidden_effect = {
			kob_expanded_remove_kobold_ruler_modifier = yes
			add_country_modifier = {
				name = kob_expanded_darkscale_kobold_ruler
				duration = -1
				hidden = yes
			}
			set_ruler_culture = darkscale_kobold
		}
	}

	option = {
		# Appoint Steel
		name = kob_expanded_government_events.1001.f

		trigger = {
			any_owned_province = {
				culture = steelscale_kobold   
			}
			NOT = {
				has_country_modifier = kob_expanded_steelscale_kobold_ruler
			}
		}

		define_ruler = {
			culture = steelscale_kobold 
			max_random_adm = 5
			max_random_dip = 1
			max_random_mil = 4
			min_age = 25
			max_age = 35
		}
		hidden_effect = {
			kob_expanded_remove_kobold_ruler_modifier = yes
			add_country_modifier = {
				name = kob_expanded_steelscale_kobold_ruler
				duration = -1
				hidden = yes
			}
			set_ruler_culture = steelscale_kobold
		}
	}
}

###############################################
# Events for the Mad Science mechanic         #
###############################################

## Sponsor researcher
country_event = {
	id = kob_expanded_government_events.1010
	title = kob_expanded_government_events.1010.title
	desc = kob_expanded_government_events.1010.desc

	picture = kob_expanded_great_scientist

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			
		}
	}

	option = {
		#Recruit a naturalist
		name = kob_expanded_government_events.1010.a

		define_advisor = {
			type = natural_scientist
			cost_multiplier = 0.5
			skill = 3
			max_age = 40
		}
		custom_tooltip = empty_line_tt
		add_country_modifier = {
			name = kob_expanded_sponsored_research
			duration = 3650
		}
	}

	option = {
		#Recruit an economic theorist
		name = kob_expanded_government_events.1010.b

		define_advisor = {
			type = master_of_mint
			cost_multiplier = 0.5
			skill = 3
			max_age = 40
		}
		custom_tooltip = empty_line_tt
		add_country_modifier = {
			name = kob_expanded_sponsored_research
			duration = 3650
		}
	}

	option = {
		#Recruit a philophser
		name = kob_expanded_government_events.1010.c

		define_advisor = {
			type = philosopher
			cost_multiplier = 0.5
			skill = 3
			max_age = 40
		}
		custom_tooltip = empty_line_tt
		add_country_modifier = {
			name = kob_expanded_sponsored_research
			duration = 3650
		}
	}
}

## Sponsor Breakthrough

country_event = {
	id = kob_expanded_government_events.1011
	title = kob_expanded_government_events.1011.title
	desc = kob_expanded_government_events.1011.desc

	picture = kob_expanded_laboratory

	is_triggered_only = yes


	option = {
		#Sponsor the project A
		name = kob_expanded_government_events.1011.a

		add_country_modifier = {
			name = kob_expanded_admin_breakthrough
			duration = 3650
		}
	}

	option = {
		#Sponsor the project B
		name = kob_expanded_government_events.1011.b

		add_country_modifier = {
			name = kob_expanded_dip_breakthrough
			duration = 3650
		}
	}

	option = {
		#Sponsor the project C
		name = kob_expanded_government_events.1011.c

		add_country_modifier = {
			name = kob_expanded_mil_breaktrhough
			duration = 3650
		}
	}
}

## Sponsor Public Lectures

country_event = {
	id = kob_expanded_government_events.1012
	title = kob_expanded_government_events.1012.title
	desc = kob_expanded_government_events.1012.desc

	picture = kob_expanded_university

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			every_owned_province = {
				limit = {
					OR = {
						has_building = university
						is_in_capital_area = yes
					}
				}
				save_event_target_as = koboldEventTarget
			}
		}
	}

	option = {
		name = kob_expanded_government_events.1012.a
		capital_scope = {
			area = {
				add_province_modifier = {
					name = kob_expanded_sponsored_lectures
					duration = 3650
				}
			}
		}
		if = {
			limit = {
				any_owned_province = {
					has_building = university
					NOT = {
						is_in_capital_area = yes
					}
				}
			}
			custom_tooltip = kob_expanded_all_university_provinces_get_institution.tooltip
			hidden_effect = {
				every_owned_province = {
					limit = {
						NOT = {
							is_in_capital_area = yes
						}
						has_building = university
					}
					add_province_modifier = {
						name = kob_expanded_sponsored_lectures
						duration = 3650
					}
				}
			}
		}
		
	}
}

## Accidents happen

country_event = {
	id = kob_expanded_government_events.1013
	title = kob_expanded_government_events.1013.title
	desc = kob_expanded_government_events.1013.desc

	picture = kob_expanded_laboratory

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			random_owned_province = {
				limit = {
					NOT = {
						is_overseas = yes
					}
					culture_group = ROOT
				}
				save_event_target_as = koboldEventTarget
			}
		
			#Determine how bad it'll be
			random_list = {
				20 = {
					#Devastation
					set_country_flag = kob_expanded_accident_small_boom_flag
				}
				15 = {
					#Lose 50% goods produced in province
					set_country_flag = kob_expanded_accident_small_accident_flag
				}
				15 = {
					#Lose manpower
					set_country_flag = kob_expanded_accident_small_death_flag
				}
				10 = {
					#Devastation and dev loss
					set_country_flag = kob_expanded_accident_medium_boom_flag
				}
				10 = {
					#Lose 50% goods produced in province and lose a random building
					set_country_flag = kob_expanded_accident_medium_accident_flag
				}
				10 = {
					#Lose manpower
					set_country_flag = kob_expanded_accident_medium_death_flag
				}
				10 = {
					#Devastation, dev loss, lose stab
					set_country_flag = kob_expanded_accident_large_boom_flag
				}
				10 = {
					#Lose 50% goods produced in province and lose a random building and lose stab
					set_country_flag = kob_expanded_accident_large_accident_flag
				}
			}
		}
	}

	option = {
		name = kob_expanded_government_events.1013.a
		goto = koboldEventTarget

		add_government_power = {
			mechanic_type = kob_expanded_mad_science
			power_type = kob_expanded_recklessness
			value = -100
		}

		add_stability = -1
	
		if = {
			limit = {
				has_country_flag = kob_expanded_accident_small_boom_flag
			}
			event_target:koboldEventTarget = {
				add_devastation = 50
				add_province_modifier = {
					name = kob_expanded_accident_unrest
					duration = 1825
				}
			}
		}
		else_if = {
			limit = {
				has_country_flag = kob_expanded_accident_small_accident_flag	
			}
			event_target:koboldEventTarget = {
				add_province_modifier = {
					name = kob_expanded_accident_damaged_equipment
					duration = 1825
				}
				add_province_modifier = {
					name = kob_expanded_accident_unrest
					duration = 1825
				}
			}
		}
		else_if = {
			limit = {
				has_country_flag = kob_expanded_accident_small_death_flag
			}
			add_yearly_manpower = -0.25
			event_target:koboldEventTarget = {
				add_province_modifier = {
					name = kob_expanded_accident_unrest
					duration = 1825
				}
			}
		}
		else_if = {
			limit = {
				has_country_flag = kob_expanded_accident_medium_boom_flag
			}
			event_target:koboldEventTarget = {
				add_province_modifier = {
					name = kob_expanded_accident_unrest
					duration = 1825
				}
				random_list = {
					33 = {
						add_base_manpower = -1
					}
					33 = {						
						add_base_tax = -1
					}
					33 = {
						add_base_production = -1
					}
				}
			}
		}
		else_if = {
			limit = {
				has_country_flag = kob_expanded_accident_medium_accident_flag
			}
			event_target:koboldEventTarget = {
				add_province_modifier = {
					name = kob_expanded_accident_damaged_equipment
					duration = 1825
				}
				add_province_modifier = {
					name = kob_expanded_accident_unrest
					duration = 1825
				}
				if = {
					limit = {
						has_building = counting_house
					}
					remove_building = counting_house
				}
				else_if = {
					limit = {
						has_building = workshop
					}
					remove_building = workshop
				}
				else = {
					add_base_production = -1
				}
			}
		}
		else_if = {
			limit = {
				has_country_flag = kob_expanded_accident_medium_death_flag
			}
			add_yearly_manpower = -0.5
			event_target:koboldEventTarget = {
				add_province_modifier = {
					name = kob_expanded_accident_unrest
					duration = 1825
				}
			}
		}
		else_if = {
			limit = {
				has_country_flag = kob_expanded_accident_large_boom_flag
			}
			event_target:koboldEventTarget = {
				add_province_modifier = {
					name = kob_expanded_accident_unrest
					duration = 1825
				}
				add_devastation = 100
				random_list = {
					33 = {
						add_base_manpower = -1
					}
					33 = {						
						add_base_tax = -1
					}
					33 = {
						add_base_production = -1
					}
				}
			}
		}
		else_if = {
			limit = {
				has_country_flag = kob_expanded_accident_large_accident_flag
			}
			event_target:koboldEventTarget = {
				add_province_modifier = {
					name = kob_expanded_accident_damaged_equipment
					duration = 1825
				}
				add_province_modifier = {
					name = kob_expanded_accident_unrest
					duration = 1825
				}
				if = {
					limit = {
						has_building = manufactory
					}
					remove_building = manufactory
				}
				else_if = {
					limit = {
						has_building = counting_house
					}
					remove_building = counting_house
				}
				else_if = {
					limit = {
						has_building = workshop
					}
					remove_building = workshop
				}
				else = {
					add_base_production = -2
				}
			}
		}
		else = {
			add_stability = -1
		}
	}

	after = {
		clr_country_flag = kob_expanded_accident_small_boom_flag
		clr_country_flag = kob_expanded_accident_small_accident_flag
		clr_country_flag = kob_expanded_accident_small_death_flag
		clr_country_flag = kob_expanded_accident_medium_boom_flag
		clr_country_flag = kob_expanded_accident_medium_accident_flag
		clr_country_flag = kob_expanded_accident_medium_death_flag
		clr_country_flag = kob_expanded_accident_large_boom_flag
		clr_country_flag = kob_expanded_accident_large_accident_flag
	}
}